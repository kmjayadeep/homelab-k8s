apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- ../../../../bases/infra/cockroachdb
- ./secret-sealed.yaml
patches:
- path: ./ingress.yaml
- path: ./service.public.yaml
- patch: |-
    - op: add
      path: "/spec/template/spec/containers/0/env/-"
      value:
        name: LOCALITY
        value: region=hetzner,zone=uranus
    - op: add
      path: "/spec/template/spec/containers/0/env/0"
      value:
        name: CLUSTER_NAME
        value: milkyway
    - op: add
      path: "/spec/template/spec/containers/1/env/0"
      value:
        name: CLUSTER_NAME
        value: milkyway
  target:
    kind: StatefulSet
    namespace: cockroachdb
    name: cockroachdb
